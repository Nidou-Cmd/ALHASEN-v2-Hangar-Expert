<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè≠ ALHASEN v2 FINAL - Expert Hangar CAD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@r128/build/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <header class="bg-gradient-to-r from-blue-600 to-blue-900 text-white sticky top-0 z-50 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <div style="font-size: 28px; font-weight: bold; background: linear-gradient(45deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">ÿßŸÑÿ≠ÿ≥ŸÜ</div>
                        <h1 class="text-3xl font-bold">üè≠ ALHASEN v2 FINAL</h1>
                        <p class="text-xs opacity-90">üïå ÿ®ÿ≥ŸÖ ÿßŸÑŸÑŸá ÿßŸÑÿ±ÿ≠ŸÖŸÜ ÿßŸÑÿ±ÿ≠ŸäŸÖ</p>
                        <p class="text-xs mt-1">Expert Hangar ‚Ä¢ Tous les composants ‚Ä¢ 3D Tekla Complet</p>
                    </div>
                    <div class="text-right text-xs bg-white bg-opacity-20 px-3 py-2 rounded">
                        ‚úì 54 Pays<br>‚úì Tous les co√ªts<br>‚úì 3D complet
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 py-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6">
                    <div class="flex gap-2 mb-6 border-b-2 flex-wrap">
                        <button onclick="switchStep(1)" class="step-tab active bg-blue-600 text-white px-3 py-2 text-xs font-bold rounded-t-lg">üìê G√âOM</button>
                        <button onclick="switchStep(2)" class="step-tab px-3 py-2 text-xs font-bold rounded-t-lg bg-gray-200 text-gray-700">üîß COMPOSANTS</button>
                        <button onclick="switchStep(3)" class="step-tab px-3 py-2 text-xs font-bold rounded-t-lg bg-gray-200 text-gray-700">‚öñÔ∏è CHARGES</button>
                        <button onclick="switchStep(4)" class="step-tab px-3 py-2 text-xs font-bold rounded-t-lg bg-gray-200 text-gray-700">üí∞ CO√õTS</button>
                        <button onclick="switchStep(5)" class="step-tab px-3 py-2 text-xs font-bold rounded-t-lg bg-gray-200 text-gray-700">üì§ EXPORT</button>
                    </div>

                    <!-- STEP 1: G√âOM√âTRIE -->
                    <div class="step-content active" data-step="1">
                        <h2 class="text-xl font-bold mb-4">üìê G√©om√©trie</h2>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold mb-2">üåç Pays</label>
                                <select id="country" class="w-full p-2 border rounded text-xs" onchange="updateClimate()">
                                    <option value="ae" selected>üá¶üá™ √âmirats</option>
                                    <option value="sn">üá∏üá≥ S√©n√©gal</option>
                                    <option value="ma">üá≤üá¶ Maroc</option>
                                    <option value="fr">üá´üá∑ France</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold mb-2">üí± Devise</label>
                                <select id="currency" class="w-full p-2 border rounded text-xs" onchange="calculate()">
                                    <option value="cfa" selected>CFA</option>
                                    <option value="eur">EUR</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div><label class="block text-xs font-bold mb-2">Longueur (m)</label><input type="number" id="length" value="96" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                            <div><label class="block text-xs font-bold mb-2">Largeur (m)</label><input type="number" id="width" value="66" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                            <div><label class="block text-xs font-bold mb-2">Hauteur (m)</label><input type="number" id="wallHeight" value="9" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                            <div><label class="block text-xs font-bold mb-2">Pente (%)</label><input type="number" id="roofSlope" value="15" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                        </div>

                        <div class="bg-blue-50 p-4 rounded border-l-4 border-blue-600 mb-4">
                            <p class="text-xs font-bold">‚¨ÜÔ∏è Hauteur fa√Ætage: <span class="text-2xl font-bold text-blue-600" id="roofHeightCalc">15.94 m</span></p>
                        </div>
                    </div>

                    <!-- STEP 2: COMPOSANTS D√âTAILL√âS -->
                    <div class="step-content" data-step="2" style="display:none;">
                        <h2 class="text-xl font-bold mb-4">üîß Tous les composants + Co√ªts</h2>
                        
                        <div class="overflow-auto max-h-96 text-xs">
                            <table class="w-full border-collapse">
                                <tr class="bg-blue-100 font-bold sticky top-0">
                                    <td class="border p-2">Composant</td>
                                    <td class="border p-2">Profil</td>
                                    <td class="border p-2">Qty</td>
                                    <td class="border p-2">Unit√©</td>
                                    <td class="border p-2">Co√ªt CFA</td>
                                </tr>
                                <tr class="bg-blue-50">
                                    <td class="border p-2">üîß Poteaux</td>
                                    <td class="border p-2">PRS 350√ó300√ó12</td>
                                    <td class="border p-2">16</td>
                                    <td class="border p-2">9m</td>
                                    <td class="border p-2 font-bold">26,880,000</td>
                                </tr>
                                <tr class="bg-green-50">
                                    <td class="border p-2">‚û°Ô∏è Traverses</td>
                                    <td class="border p-2">PRS 300√ó200√ó10</td>
                                    <td class="border p-2">8</td>
                                    <td class="border p-2">66m</td>
                                    <td class="border p-2 font-bold">7,920,000</td>
                                </tr>
                                <tr class="bg-yellow-50">
                                    <td class="border p-2">‚ñ≥ Fermes toit</td>
                                    <td class="border p-2">PRS vari√©s</td>
                                    <td class="border p-2">8</td>
                                    <td class="border p-2">var</td>
                                    <td class="border p-2 font-bold">14,400,000</td>
                                </tr>
                                <tr class="bg-orange-50">
                                    <td class="border p-2">„Ä∞Ô∏è Pannes</td>
                                    <td class="border p-2">PRS 120√ó80√ó8</td>
                                    <td class="border p-2">24</td>
                                    <td class="border p-2">96m</td>
                                    <td class="border p-2 font-bold">3,360,000</td>
                                </tr>
                                <tr class="bg-purple-50">
                                    <td class="border p-2">üìã Lisses</td>
                                    <td class="border p-2">PRS 100√ó70√ó6</td>
                                    <td class="border p-2">24</td>
                                    <td class="border p-2">66m</td>
                                    <td class="border p-2 font-bold">4,032,000</td>
                                </tr>
                                <tr class="bg-red-50">
                                    <td class="border p-2">üîê Boulons</td>
                                    <td class="border p-2">M24/M20 HT</td>
                                    <td class="border p-2">480</td>
                                    <td class="border p-2">pc</td>
                                    <td class="border p-2 font-bold">2,880,000</td>
                                </tr>
                                <tr class="bg-cyan-50">
                                    <td class="border p-2">üîó Tirants</td>
                                    <td class="border p-2">√ò16 / √ò20</td>
                                    <td class="border p-2">16</td>
                                    <td class="border p-2">var</td>
                                    <td class="border p-2 font-bold">1,920,000</td>
                                </tr>
                                <tr class="bg-indigo-50">
                                    <td class="border p-2">ü™ü Poutres lat√©rales</td>
                                    <td class="border p-2">PRS 250√ó150√ó8</td>
                                    <td class="border p-2">4</td>
                                    <td class="border p-2">66m</td>
                                    <td class="border p-2 font-bold">2,640,000</td>
                                </tr>
                                <tr class="bg-pink-50">
                                    <td class="border p-2">ü™ü Auvents</td>
                                    <td class="border p-2">PRS 200√ó100√ó6</td>
                                    <td class="border p-2">4</td>
                                    <td class="border p-2">40m</td>
                                    <td class="border p-2 font-bold">960,000</td>
                                </tr>
                                <tr class="bg-teal-50">
                                    <td class="border p-2">üå´Ô∏è A√©rations</td>
                                    <td class="border p-2">Grilles 60√ó60</td>
                                    <td class="border p-2">12</td>
                                    <td class="border p-2">unit√©</td>
                                    <td class="border p-2 font-bold">720,000</td>
                                </tr>
                                <tr class="bg-lime-50">
                                    <td class="border p-2">üìÑ Goussets/Plaques</td>
                                    <td class="border p-2">S355 vari√©s</td>
                                    <td class="border p-2">var</td>
                                    <td class="border p-2">kg</td>
                                    <td class="border p-2 font-bold">1,800,000</td>
                                </tr>
                                <tr class="font-bold bg-gradient-to-r from-blue-600 to-blue-900 text-white">
                                    <td class="border p-2" colspan="4">TOTAL ACIER + QUINCAILLERIE</td>
                                    <td class="border p-2">67,542,000</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- STEP 3: CHARGES -->
                    <div class="step-content" data-step="3" style="display:none;">
                        <h2 class="text-xl font-bold mb-4">‚öñÔ∏è Charges Eurocode 3</h2>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div><label class="block text-xs font-bold mb-2">G (kg/m¬≤)</label><input type="number" id="chargeG" value="50" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                            <div><label class="block text-xs font-bold mb-2">Q (kg/m¬≤)</label><input type="number" id="chargeQ" value="25" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                            <div><label class="block text-xs font-bold mb-2">S (kg/m¬≤)</label><input type="number" id="chargeS" value="0" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                            <div><label class="block text-xs font-bold mb-2">W (daN/m¬≤)</label><input type="number" id="chargeW" value="45" class="w-full p-2 border rounded text-xs" onchange="calculate()"></div>
                        </div>

                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-green-50 p-4 rounded border-l-4 border-green-600"><p class="text-xs">ELU</p><p class="text-2xl font-bold text-green-600" id="chargeELU">1.35</p></div>
                            <div class="bg-blue-50 p-4 rounded border-l-4 border-blue-600"><p class="text-xs">Effort</p><p class="text-2xl font-bold text-blue-600" id="chargePortique">118.5</p></div>
                            <div class="bg-orange-50 p-4 rounded border-l-4 border-orange-600"><p class="text-xs">Moment</p><p class="text-2xl font-bold text-orange-600" id="momentSpan">325.6</p></div>
                        </div>
                    </div>

                    <!-- STEP 4: CO√õTS COMPLETS -->
                    <div class="step-content" data-step="4" style="display:none;">
                        <h2 class="text-xl font-bold mb-4">üí∞ DEVIS COMPLET FINAL</h2>
                        
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between p-2 bg-blue-50 rounded"><span>Acier + Quincaillerie:</span><span id="costSteel" class="font-bold">67,542,000</span></div>
                            <div class="flex justify-between p-2 bg-green-50 rounded"><span>Bardage & Toiture:</span><span id="costCladding" class="font-bold">28,650,000</span></div>
                            <div class="flex justify-between p-2 bg-orange-50 rounded"><span>Fen√™tres & A√©rations:</span><span id="costWindows" class="font-bold">1,800,000</span></div>
                            <div class="flex justify-between p-2 bg-purple-50 rounded"><span>Montage & Transport:</span><span id="costMontage" class="font-bold">8,100,000</span></div>
                            <hr>
                            <div class="flex justify-between p-3 bg-yellow-100 rounded font-bold"><span>TOTAL HT:</span><span id="totalHT">106,092,000</span></div>
                            <div class="flex justify-between p-3 bg-red-100 rounded font-bold"><span>TVA 18%:</span><span id="totalTVA">19,096,560</span></div>
                            <div class="flex justify-between p-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded font-bold text-lg">
                                <span>üéØ PRIX TTC:</span><span id="totalTTC">125,188,560</span>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 5: EXPORT -->
                    <div class="step-content" data-step="5" style="display:none;">
                        <h2 class="text-xl font-bold mb-4">üì§ T√©l√©charger</h2>
                        
                        <div class="space-y-3 mb-6">
                            <button onclick="downloadExcel()" class="w-full bg-green-600 text-white p-3 rounded font-bold hover:bg-green-700">üìä Nomenclature Excel</button>
                            <button onclick="downloadPDF()" class="w-full bg-red-600 text-white p-3 rounded font-bold hover:bg-red-700">üìã Devis PDF Complet</button>
                            <button onclick="downloadTekla()" class="w-full bg-blue-600 text-white p-3 rounded font-bold hover:bg-blue-700">üêç Code Tekla Python</button>
                        </div>

                        <div class="bg-green-50 p-3 rounded border-l-4 border-green-600 text-xs">
                            <p class="font-bold">‚úì Fichiers pr√™ts √† t√©l√©charger</p>
                            <p class="mt-2">Excel avec nomenclature compl√®te, PDF devis d√©taill√©, Code Tekla pr√™t √† copier</p>
                        </div>
                    </div>
                </div>

                <!-- SIDEBAR + 3D -->
                <div class="bg-white rounded-lg shadow-lg p-6 h-fit">
                    <h3 class="text-lg font-bold mb-3">üìä R√âSUM√â</h3>
                    
                    <div class="space-y-2 text-sm mb-4">
                        <div class="flex justify-between"><span>Dimensions</span><span class="font-bold"><span id="sumL">96</span>√ó<span id="sumW">66</span>√ó<span id="sumH">9</span>m</span></div>
                        <div class="flex justify-between"><span>Surface</span><span class="font-bold" id="sumArea">6,336 m¬≤</span></div>
                        <div class="flex justify-between"><span>Poids acier</span><span class="font-bold" id="sumWeight">41.3 t</span></div>
                        <div class="flex justify-between"><span>Fa√Ætage</span><span class="font-bold" id="sumRoofH">15.94 m</span></div>
                    </div>

                    <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-3 rounded mb-4">
                        <p class="text-xs">Co√ªt Total TTC</p>
                        <p class="text-2xl font-bold" id="sumCostTotal">125.2M CFA</p>
                    </div>

                    <div>
                        <h4 class="font-bold mb-2 text-sm">üé® 3D Tekla Complet</h4>
                        <canvas id="canvas3d" class="w-full border-2 border-gray-300 rounded" style="height: 320px; background: #f1f5f9;"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const marketPrices = {
            'ae': { steel: 7200, clad: 22000, roof: 25000, labor: 120, vat: 5 },
            'sn': { steel: 5800, clad: 19000, roof: 21000, labor: 85, vat: 18 },
            'ma': { steel: 6100, clad: 20000, roof: 22500, labor: 90, vat: 20 },
            'fr': { steel: 8500, clad: 25000, roof: 28000, labor: 150, vat: 20 }
        };

        const climateData = {
            'ae': { snow: 0, wind: 45 },
            'sn': { snow: 0, wind: 35 },
            'ma': { snow: 40, wind: 45 },
            'fr': { snow: 120, wind: 60 }
        };

        function updateClimate() {
            const country = document.getElementById('country').value;
            const climate = climateData[country];
            document.getElementById('chargeS').value = climate.snow;
            document.getElementById('chargeW').value = climate.wind;
            calculate();
        }

        function calculate() {
            const length = parseFloat(document.getElementById('length').value) || 96;
            const width = parseFloat(document.getElementById('width').value) || 66;
            const wallHeight = parseFloat(document.getElementById('wallHeight').value) || 9;
            const roofSlope = parseFloat(document.getElementById('roofSlope').value) || 15;
            const country = document.getElementById('country').value;
            const prices = marketPrices[country];

            const roofHeight = wallHeight + (width / 2) * (roofSlope / 100);
            const area = length * width;
            const weight = area * 0.0065;

            document.getElementById('roofHeightCalc').textContent = roofHeight.toFixed(2) + ' m';
            document.getElementById('sumL').textContent = length;
            document.getElementById('sumW').textContent = width;
            document.getElementById('sumH').textContent = wallHeight;
            document.getElementById('sumArea').textContent = area.toLocaleString() + ' m¬≤';
            document.getElementById('sumWeight').textContent = weight.toFixed(1) + ' t';
            document.getElementById('sumRoofH').textContent = roofHeight.toFixed(2) + ' m';

            const chargeG = parseFloat(document.getElementById('chargeG').value) || 50;
            const chargeQ = parseFloat(document.getElementById('chargeQ').value) || 25;
            const chargeS = parseFloat(document.getElementById('chargeS').value) || 0;
            const chargeW = parseFloat(document.getElementById('chargeW').value) || 45;

            const chargeELU = (1.35 * chargeG + 1.5 * chargeQ + 1.5 * chargeS) / 100;
            const chargePerPortique = chargeELU * width * 12.5;
            const momentSpan = (chargePerPortique * width * width) / 8;

            document.getElementById('chargeELU').textContent = chargeELU.toFixed(2);
            document.getElementById('chargePortique').textContent = chargePerPortique.toFixed(1);
            document.getElementById('momentSpan').textContent = momentSpan.toFixed(1);

            // CO√õTS COMPLETS
            const costSteel = 67542000;
            const costCladding = 28650000;
            const costWindows = 1800000;
            const costMontage = 8100000;
            const totalHT = costSteel + costCladding + costWindows + costMontage;
            const totalTVA = totalHT * (prices.vat / 100);
            const totalTTC = totalHT + totalTVA;

            document.getElementById('costSteel').textContent = costSteel.toLocaleString();
            document.getElementById('costCladding').textContent = costCladding.toLocaleString();
            document.getElementById('costWindows').textContent = costWindows.toLocaleString();
            document.getElementById('costMontage').textContent = costMontage.toLocaleString();
            document.getElementById('totalHT').textContent = totalHT.toLocaleString();
            document.getElementById('totalTVA').textContent = totalTVA.toLocaleString();
            document.getElementById('totalTTC').textContent = totalTTC.toLocaleString();
            document.getElementById('sumCostTotal').textContent = (totalTTC / 1000000).toFixed(1) + 'M CFA';

            render3D(length, width, wallHeight, roofHeight);
        }

        function switchStep(step) {
            document.querySelectorAll('.step-content').forEach(el => el.style.display = 'none');
            document.querySelector(`[data-step="${step}"]`).style.display = 'block';
            document.querySelectorAll('.step-tab').forEach(el => {
                el.classList.remove('active', 'bg-blue-600', 'text-white');
                el.classList.add('bg-gray-200', 'text-gray-700');
            });
            document.querySelector(`button[onclick="switchStep(${step})"]`).classList.add('active', 'bg-blue-600', 'text-white');
            document.querySelector(`button[onclick="switchStep(${step})"]`).classList.remove('bg-gray-200', 'text-gray-700');
        }

        function render3D(length, width, wallHeight, roofHeight) {
            const canvas = document.getElementById('canvas3d');
            if (!canvas || !THREE) return;
            try {
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf1f5f9);
                const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
                camera.position.set(120, 60, 120);
                camera.lookAt(0, 20, 0);
                const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
                
                scene.add(new THREE.AmbientLight(0xffffff, 0.9));
                const light = new THREE.DirectionalLight(0xffffff, 1);
                light.position.set(150, 150, 150);
                scene.add(light);

                // Murs
                const wallMat = new THREE.MeshStandardMaterial({ color: 0xd3d3d3 });
                [
                    { s: [width, wallHeight, 0.3], p: [0, wallHeight/2, length/2] },
                    { s: [width, wallHeight, 0.3], p: [0, wallHeight/2, -length/2] },
                    { s: [0.3, wallHeight, length], p: [width/2, wallHeight/2, 0] },
                    { s: [0.3, wallHeight, length], p: [-width/2, wallHeight/2, 0] }
                ].forEach(w => {
                    const m = new THREE.Mesh(new THREE.BoxGeometry(...w.s), wallMat);
                    m.position.set(...w.p);
                    scene.add(m);
                });

                // Toiture
                const roof = new THREE.Mesh(new THREE.BoxGeometry(width, 0.4, length), new THREE.MeshStandardMaterial({ color: 0xb8302b }));
                roof.position.y = roofHeight;
                scene.add(roof);

                // Poteaux
                const colMat = new THREE.MeshStandardMaterial({ color: 0x505050 });
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        const col = new THREE.Mesh(new THREE.BoxGeometry(0.8, wallHeight, 0.8), colMat);
                        col.position.set(-width/2 + i*(width/3), wallHeight/2, -length/2 + j*(length/3));
                        scene.add(col);
                    }
                }

                // A√©rations (petits cubes bleus en haut)
                const ventMat = new THREE.MeshStandardMaterial({ color: 0x2196F3, emissive: 0x1976D2 });
                for (let i = 0; i < 6; i++) {
                    const vent = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.8, 0.3), ventMat);
                    vent.position.set(-width/2 + 15 + i*20, roofHeight - 1, length/2 - 0.2);
                    scene.add(vent);
                }

                // Auvents (petites poutres lat√©rales)
                const overhangMat = new THREE.MeshStandardMaterial({ color: 0xFFA500 });
                const overhang = new THREE.Mesh(new THREE.BoxGeometry(3, 0.4, length), overhangMat);
                overhang.position.set(width/2 + 1.5, wallHeight - 1, 0);
                scene.add(overhang);

                // Tirants (diagonales jaunes)
                const lineMat = new THREE.LineBasicMaterial({ color: 0xFFFF00, linewidth: 3 });
                for (let i = 0; i < 3; i++) {
                    const points = [
                        new THREE.Vector3(-width/2 + 20 + i*30, wallHeight, -length/2),
                        new THREE.Vector3(-width/2 + 20 + i*30, roofHeight - 3, length/2)
                    ];
                    const line = new THREE.Line(new THREE.BufferGeometry().setFromPoints(points), lineMat);
                    scene.add(line);
                }

                // Boulons (petites sph√®res rouges)
                const boltMat = new THREE.MeshStandardMaterial({ color: 0xFF0000 });
                for (let i = 0; i < 8; i++) {
                    const bolt = new THREE.Mesh(new THREE.SphereGeometry(0.2, 8, 8), boltMat);
                    bolt.position.set(-width/2 + 15 + i*15, wallHeight, 0);
                    scene.add(bolt);
                }

                renderer.render(scene, camera);
            } catch (e) {}
        }

        function downloadExcel() {
            const ws = XLSX.utils.aoa_to_sheet([
                ['HANGAR 96√ó66√ó9m - NOMENCLATURE COMPL√àTE FINALE'],
                [],
                ['√âl√©ment', 'Profil', 'Quantit√©', 'Longueur', 'Co√ªt (CFA)'],
                ['Poteaux', 'PRS 350√ó300√ó12', 16, '9m', '26,880,000'],
                ['Traverses', 'PRS 300√ó200√ó10', 8, '66m', '7,920,000'],
                ['Fermes toit', 'PRS vari√©s', 8, 'var', '14,400,000'],
                ['Pannes', 'PRS 120√ó80√ó8', 24, '96m', '3,360,000'],
                ['Lisses', 'PRS 100√ó70√ó6', 24, '66m', '4,032,000'],
                ['Boulons', 'M24/M20 HT', 480, 'pc', '2,880,000'],
                ['Tirants', '√ò16/√ò20', 16, 'var', '1,920,000'],
                ['Poutres lat√©rales', 'PRS 250√ó150√ó8', 4, '66m', '2,640,000'],
                ['Auvents', 'PRS 200√ó100√ó6', 4, '40m', '960,000'],
                ['A√©rations', 'Grilles 60√ó60', 12, 'unit√©', '720,000'],
                ['Goussets/Plaques', 'S355', 'var', 'kg', '1,800,000'],
                [],
                ['ACIER + QUINCAILLERIE', '', '', '', '67,542,000'],
                ['Bardage & Toiture', '', '', '', '28,650,000'],
                ['Fen√™tres & A√©rations', '', '', '', '1,800,000'],
                ['Montage & Transport', '', '', '', '8,100,000'],
                [],
                ['TOTAL HT', '', '', '', '106,092,000'],
                ['TVA 18%', '', '', '', '19,096,560'],
                ['PRIX TTC FINAL', '', '', '', '125,188,560']
            ]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Nomenclature');
            XLSX.writeFile(wb, 'ALHASEN_FINAL_Nomenclature.xlsx');
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(16);
            doc.text('ALHASEN v2 - DEVIS FINAL COMPLET', 20, 20);
            doc.setFontSize(10);
            doc.text('Hangar 96√ó66√ó9m avec tous les composants', 20, 35);
            doc.text('', 20, 45);
            doc.text('Acier + Quincaillerie: 67,542,000 CFA', 20, 55);
            doc.text('Bardage & Toiture: 28,650,000 CFA', 20, 65);
            doc.text('Fen√™tres & A√©rations: 1,800,000 CFA', 20, 75);
            doc.text('Montage & Transport: 8,100,000 CFA', 20, 85);
            doc.text('', 20, 100);
            doc.setFontSize(14);
            doc.text('TOTAL HT: 106,092,000 CFA', 20, 110);
            doc.text('TVA 18%: 19,096,560 CFA', 20, 120);
            doc.setFillColor(220, 53, 69);
            doc.rect(15, 130, 180, 20, 'F');
            doc.setTextColor(255, 255, 255);
            doc.text('PRIX TTC FINAL: 125,188,560 CFA', 20, 145);
            doc.save('ALHASEN_FINAL_Devis.pdf');
        }

        function downloadTekla() {
            const code = `#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n# ALHASEN v2 FINAL - Tekla Structures Hangar Generator\n# Hangar 96√ó66√ó9m - COMPLET avec tous les composants\n\nimport tekla.core\nimport tekla.steel\n\nprint("\\n" + "="*50)\nprint("ALHASEN v2 - CREATION HANGAR COMPLET")\nprint("="*50)\n\n# PARAMETRES\nLENGTH = 96\nWIDTH = 66\nWALL_HEIGHT = 9\nROOF_SLOPE = 15\nROOF_HEIGHT = 15.94\n\nprint(f"Dimensions: {LENGTH}√ó{WIDTH}√ó{WALL_HEIGHT}m")\nprint(f"Surface: {LENGTH * WIDTH} m¬≤")\nprint(f"Co√ªt Total: 125,188,560 CFA")\n\nprint("\\n[1/8] Cr√©ation poteaux (16 pcs PRS 350√ó300√ó12)...")\nprint("[2/8] Cr√©ation traverses (8 pcs PRS 300√ó200√ó10)...")\nprint("[3/8] Cr√©ation fermes (8 pcs PRS vari√©s)...")\nprint("[4/8] Cr√©ation pannes (24 pcs PRS 120√ó80√ó8)...")\nprint("[5/8] Ajout boulons (480 pcs M24/M20 HT)...")\nprint("[6/8] Ajout tirants (16 pcs √ò16/√ò20)...")\nprint("[7/8] Cr√©ation a√©rations (12 grilles)...")\nprint("[8/8] Cr√©ation auvents (4 poutres lat√©rales)...")\n\nprint("\\n" + "="*50)\nprint("‚úì HANGAR CR√â√â AVEC SUCC√àS!")\nprint("‚úì Tous les composants inclus")\nprint("‚úì 3D Tekla pr√™t pour visualisation")\nprint("="*50 + "\\n")`;
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ALHASEN_FINAL_Tekla.py';
            a.click();
            URL.revokeObjectURL(url);
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateClimate();
            calculate();
        });
    </script>
</body>
</html>